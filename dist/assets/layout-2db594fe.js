import{u as A,r as b,c as p,o,a as s,b as e,d as g,n as D,e as z,f as v,g as O,h as m,t as f,F as y,i as S,j as x,w as B,k as U,l as V,m as q,R as G}from"./index-124aa391.js";import{D as H}from"./dialog-fff85c0d.js";import{c as J}from"./sendWS-cc91bdd3.js";const K="/assets/chatIcon-7602e55a.png",Q={class:"bg-white dark:bg-gray-900 fixed w-full z-20 top-0 left-0 border-b border-gray-200 dark:border-gray-600 z-50"},W={class:"max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"},X=e("span",{class:"sr-only"},"Open main menu",-1),Y=e("svg",{class:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 14"},[e("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M1 1h15M1 7h15M1 13h15"})],-1),Z=[X,Y],ee=e("a",{href:"",class:"flex items-center"},[e("img",{src:K,class:"h-8 mr-3",alt:"chat Logo"}),e("span",{class:"self-center text-2xl font-semibold whitespace-nowrap dark:text-white"},"Chat")],-1),te={class:"flex md:order-2"},re={key:0,href:"/API/logout",class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center md:mr-3 mr-1 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 ml-2"},oe=e("span",{class:"sr-only"},"Open main menu",-1),ae=e("svg",{class:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 14"},[e("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M1 1h15M1 7h15M1 13h15"})],-1),se=[oe,ae],ne={class:"flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700"},le={__name:"navbar",setup(M){const n=A(),l=b(!1),u=p(()=>n.state.loginInfo),c=p(()=>n.state.openSide);function w(){n.dispatch("openSide",c.value)}return(F,t)=>(o(),s("nav",Q,[e("div",W,[e("button",{"data-collapse-toggle":"navbar-sticky",type:"button",onClick:t[0]||(t[0]=i=>w()),class:"inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-controls":"navbar-sticky","aria-expanded":"false"},Z),ee,e("div",te,[!u.value.mobile&&u.value.authTF?(o(),s("a",re,"Logout")):g("",!0),e("button",{"data-collapse-toggle":"navbar-sticky",type:"button",onClick:t[1]||(t[1]=i=>l.value=!l.value),class:"inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-controls":"navbar-sticky","aria-expanded":"false"},se)]),e("div",{class:D(["items-center justify-between w-full md:flex md:w-auto md:order-1",l.value?"":"hidden"]),id:"navbar-sticky"},[e("ul",ne,[e("li",{onClick:t[3]||(t[3]=i=>l.value=!1)},[e("a",{href:"/#/article",class:"block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700",onClick:t[2]||(t[2]=i=>l.value=!1)},"Article")]),e("li",{onClick:t[5]||(t[5]=i=>l.value=!1)},[e("a",{href:"/#/personal",class:"block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700",onClick:t[4]||(t[4]=i=>l.value=!1)},"Personal")]),e("li",{onClick:t[7]||(t[7]=i=>l.value=!1)},[e("a",{href:"/#/stickerStore",class:"block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700",onClick:t[6]||(t[6]=i=>l.value=!1)},"Store")]),e("li",{onClick:t[9]||(t[9]=i=>l.value=!1)},[e("a",{href:"/#/mySticker",class:"block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700",onClick:t[8]||(t[8]=i=>l.value=!1)},"My Sticker")]),u.value.mobile&&u.value.authTF?(o(),s("li",{key:0,onClick:t[11]||(t[11]=i=>l.value=!1)},[e("a",{href:"/API/logout",class:"block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700",onClick:t[10]||(t[10]=i=>l.value=!1)},"Logout")])):g("",!0)])],2)])]))}},de={class:"h-full px-3 pb-4 overflow-y-auto bg-white dark:bg-gray-800"},ie={class:"inline-flex rounded-md shadow-sm mb-3",role:"group"},ue={type:"button",href:"/#/addFriend",class:"px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-r-md hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white"},ge={key:0},ce=e("hr",null,null,-1),he={class:"space-y-2 font-medium"},fe=["onClick"],pe=["src"],me={class:"flex-1 ml-3 whitespace-nowrap"},be=e("hr",null,null,-1),ve={class:"space-y-2 font-medium"},ke=["onClick"],ye=["src"],xe={class:"flex-1 ml-3 whitespace-nowrap"},we={key:1,class:"space-y-2 font-medium"},_e=["onClick"],Ie=["src"],$e={class:"flex-1 ml-3 whitespace-nowrap"},Ce={key:2,class:"inline-flex items-center justify-center w-4 h-4 ml-2 text-xs font-semibold text-blue-800 bg-blue-200 rounded-full"},Se={__name:"sidebar",setup(M){const n=A(),l=z(),u=p(()=>n.state.loginInfo),c=p(()=>n.state.friends),w=p(()=>n.state.rooms),F=p(()=>n.state.openSide),t=b(1),i=b(!0),_=b(!0),I=b(!1),$=b({});J(),R();function L(){v({method:"post",url:"API/friends",params:{method:"getFriends",loginInfo:u.value}}).then(function(a){n.dispatch("a_friends",a.data.get_friends),t.value=0})}function R(){v({method:"post",url:"API/rooms",params:{method:"getRooms",loginInfo:u.value}}).then(function(a){n.dispatch("a_rooms",a.data.get_rooms),t.value=1})}function T(a){v({method:"post",url:"API/friends",params:{method:"getFriend",loginInfo:u.value},data:{item:a}}).then(function(d){l.push({path:"/friends",query:{token:a.token}}),n.dispatch("a_friend",d.data.get_friend),n.dispatch("openSide",!1),t.value=0})}function N(a){P(a),n.dispatch("openSide",!1),l.push({name:"chatPlatForm",query:{token:a.token,FRIEND_EMAIL:a.FRIEND_EMAIL,ROOMID:a.ROOMID}})}function P(a){v({method:"post",url:"API/messages",params:{method:"getMessage",loginInfo:u.value},data:{item:a}}).then(function(d){n.dispatch("a_updMessages",d.data.get_messages)})}function j(a){a.STATUS=1,v({method:"post",url:"API/friends",params:{method:"updFriend",loginInfo:u.value},data:{item:a}}).then(function(d){n.dispatch("a_friend",d.data.get_friend)})}function E(a){return c.value.length>0?c.value.filter(d=>d.STATUS==a).length:0}return(a,d)=>{const h=O("font-awesome-icon");return o(),s(y,null,[e("aside",{id:"logo-sidebar",class:D([F.value?"transition-transform -translate-x-full":"","z-40 fixed top-0 left-0 w-64 h-screen pt-24 bg-white border-r border-gray-200 sm:translate-x-0 dark:bg-gray-800 dark:border-gray-700"]),"aria-label":"Sidebar"},[e("div",de,[e("div",ie,[e("button",{type:"button",onClick:L,class:"px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white"},[m(h,{icon:"fa-solid fa-user-group"})]),e("button",{type:"button",onClick:R,class:"px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white"},[m(h,{icon:"fa-solid fa-message"})]),e("a",ue,[m(h,{icon:"fa-solid fa-user-plus"})])]),t.value==0?(o(),s("div",ge,[e("div",null,[e("label",{onClick:d[0]||(d[0]=r=>_.value=!_.value),class:"cursor-pointer select-none font-bold"},"好友請求("+f(E(-200))+")",1),ce,e("ul",he,[(o(!0),s(y,null,S(c.value,(r,k)=>(o(),s("li",{key:k},[r.STATUS<=-200&&_.value?(o(),s("a",{key:0,onClick:C=>T(r),class:"flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group cursor-pointer select-none"},[r.headshot?(o(),s("img",{key:0,class:"h-6 w-6 rounded-full bg-white border-inherit border-1",src:r.headshot},null,8,pe)):(o(),x(h,{key:1,icon:"fa-solid fa-user"})),e("span",me,f(r.FRIEND_EMAIL),1),r.STATUS==-200?(o(),x(h,{key:2,icon:"fa-solid fa-plus",onClick:B(C=>{$.value=r,I.value=!0},["stop"])},null,8,["onClick"])):g("",!0)],8,fe)):g("",!0)]))),128))]),e("label",{onClick:d[1]||(d[1]=r=>i.value=!i.value),class:"cursor-pointer select-none font-bold"},"好友("+f(E(1))+")",1),be,e("ul",ve,[(o(!0),s(y,null,S(c.value,(r,k)=>(o(),s("li",{key:k},[r.STATUS==1&&i.value?(o(),s("a",{key:0,onClick:C=>T(r),class:"flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group cursor-pointer select-none"},[r.headshot?(o(),s("img",{key:0,class:"h-6 w-6 rounded-full bg-white border-inherit border-1",src:r.headshot},null,8,ye)):(o(),x(h,{key:1,icon:"fa-solid fa-user"})),e("span",xe,f(r.FRIEND_EMAIL),1)],8,ke)):g("",!0)]))),128))])])])):g("",!0),t.value==1?(o(),s("ul",we,[(o(!0),s(y,null,S(w.value,(r,k)=>(o(),s("li",{key:k},[e("a",{onClick:C=>{N(r)},class:"flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group cursor-pointer"},[r.headshot?(o(),s("img",{key:0,class:"h-6 w-6 rounded-full bg-white border-1 border-inherit",src:r.headshot},null,8,Ie)):(o(),x(h,{key:1,icon:"fa-solid fa-user"})),e("span",$e,f(r.FRIEND_EMAIL),1),r.unread>0?(o(),s("span",Ce,f(r.unread),1)):g("",!0)],8,_e)]))),128))])):g("",!0)])],2),m(H,{onConfirm:d[2]||(d[2]=r=>j($.value)),openShow:I.value,onClose:d[3]||(d[3]=r=>I.value=!1)},{body:U(()=>[V(f("同意好友申請: "+$.value.FRIEND_EMAIL),1)]),_:1},8,["openShow"])],64)}}},Re={__name:"layout",setup(M){const n=A(),l=p(()=>n.state.loginInfo);return setInterval(function(){v({method:"post",url:"API/auth",responseType:"json",params:{method:"tokenRefresh",loginInfo:l.value}}).then(function(u){n.dispatch("update_loginToken",u.data)})},1e3*60*60),(u,c)=>(o(),s("div",null,[m(le),m(Se),m(q(G))]))}};export{Re as default};
